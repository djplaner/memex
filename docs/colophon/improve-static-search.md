---
title: Improve static search
type: note
tags:
    - colophon
    - search
---

[[comparing-wordpress-to-memex|Comparing Wordpress to Memex]] revealed that the MkDocs static search's payload (14 Mb) significantly increases the size of the web pages. Look into alternatives - server side or client. Also, [lunr.js](https://github.com/olivernn/lunr.js/) used by MkDocs hasn't been updated recently (5-7 years).

!!! note "Memex and blog updated to page find"

    By June 2025, both my Memex and [blog](https://djon.es/blog/) have been updated to use [Page Find](https://pagefind.app) for static search. Both sites are now significantly faster to load and the search experience is improved.

## Alternatives

[PageFind](https://pagefind.app) - client site static site search designed to work well with large sites.

Looked at a few others, but PageFind appears the most recent and functional of the available options.

### Example uses of page find

- [Bryce Wray](https://www.brycewray.com/search/) - uses a separate search page
- [Sebastian Proost](https://blog.4dcu.be/programming/2022/08/27/pagefind.html) - modal for search 

## Tests with Page Find

Runs after SSG and outputs static search bundle to the generated site. Comes with a Python wrapper. Quick analysis with Lighthouse gives the following results - Page Find is faster than lunr.js (the MkDocs search). It also shows that perhaps Lighthouse analysis is not perfect. However, the difference is sufficient to try a full scale implementation.

| Site config | Performance Local | Performance Remote| Blog Remote |
|-------------|-------------|-------------|-------------|
| MkDocs with no search | 96 | 96 | 75 |
| MkDocs with lunr.js search | 80 | | 64 |
| MkDocs with Page Find search | 97 | 96 | 82 (95<sup>1</sup>) |

<sup>1</sup> - with number of posts on the home page reduced from 20 to 10.

Blog

- search_index.json - 4.481Kb, twice the size of the largest image

## Migration to Page Find

Seems to involve the following steps:

- [x] Modify the MkDocs configuration to remove the lunr.js search plugin.
- [x] Modify the MkDocs themes to include the Page Find search interface.
- [x] Add the Page Find build step at the MkDocs build.
- [x] Make any additional changes required.

### Example uses of page find

- [Bryce Wray](https://www.brycewray.com/search/) - uses a separate search page
- [Sebastian Proost](https://blog.4dcu.be/programming/2022/08/27/pagefind.html) - modal for search 

### Additional changes

- Modify mkdocs configuration to work with pagefind.

    Appears that the [instant loading feature](https://squidfunk.github.io/mkdocs-material/setup/setting-up-navigation/#instant-loading) for Material for MkDocs was causing issues for pagefind. It had to be turned off.

- [Configure the indexing](https://pagefind.app/docs/indexing/)

    Add `data-pagefind-body` to the main content div via a MkDocs template.

- [Configure the ui](https://pagefind.app/docs/ui-usage/)

    Tweak the memex CSS.

- [Explore config of metadata](https://pagefind.app/docs/metadata/), in particular to get the displayed images to work (not absolute). [This](https://blog.4dcu.be/programming/2022/08/27/pagefind.html) mentions one need to fix images.

    Decided not to include images in the search, too few pages have images.

- [Consider CSP](https://pagefind.app/docs/hosting/)

    Especially for the blog

- Extend the MkDocs build process

    Wrote a shell script to handle this.

## Move blog to Page Find

THe [blog](https://djon.es/blog/) is a MkDocs site which also appears slow due to the size of lunr.js search index. Time to migrate it to Page Find as well. 

The blog has a CSP set, which will complicate the migration.

- [x] Modify the MkDocs configuration to remove the lunr.js search plugin.
    - Remove search plugin from mkdocs.yml
- [x] Modify the MkDocs themes to include the Page Find search interface.
    - [x] main.html > blog_home, blog-post, blog-category
    - [x] content.html > post-list, post-content, archives-list
    - [x] CSS
    - [x] Make search icon disappear until content loaded
- [x] Update the build process
    - util/build.sh
- [x] Make any additional changes required.



[//begin]: # "Autogenerated link references for markdown compatibility"
[comparing-wordpress-to-memex|Comparing Wordpress to Memex]: comparing-wordpress-to-memex "Comparing Wordpress to Memex"
[//end]: # "Autogenerated link references"