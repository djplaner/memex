---
title: Foam extension entry file
type: note
tags: [foam-dev, foam-code, vscode-extension]
---

See also: [[understanding-foam-code-base]]

Diving in detail into the `extension.ts` Foam file. Only contains a single function `activate` which is called if VSCode detects the presence of a `foam.json` file in the workspace. 

!!! note "Tentative understanding"

    My understanding of contemporary TypeScript development is limited at this stage. The following is likely to have misunderstandings and only useful to me.

## Logger

Sets up (what appears to be) a standard VSCode logger and uses it and finishes if no `workspaceFolders` are detected

```ts 
const logger = new VsCodeOutputLogger();
Logger.setDefaultLogger(logger);
exposeLogger(context, logger);
```

`context` is a parameter to the activate function. 

## Preparing Foam

Define which files to exclude and generate `matcher` and `dataStore` objects working with those.

```ts
const excludes = getIgnoredFilesSetting().map(g => g.toString());
const { matcher, dataStore, excludePatterns } =
  await createMatcherAndDataStore(excludes);
```

Create 

- a watcher for the filesystem
- a parser cache
- markdown parser

Grab various settings from the VSCode configuration and use those to set up relevant objects to perform associated tasks

- `getNotesExtensions`
- `getAttachmentsExtensions` ... `new AttachmentResourceProvider( attachmentExtConfig)`

Bootstrap the `Foam` object/promise, passing in all the objects created above.

```ts
const foamPromise = bootstrap(
  matcher,
  watcher,
  dataStore,
  parser,
  [markdownProvider, attachmentProvider],
  defaultExtension
);
```

Load the features

```ts
const featuresPromises = features.map(feature =>
  feature(context, foamPromise)
);
```

Await the `foamPromise` above to be complete - Foam all set up.

Push all the created objects into `subscriptions` to ensure VSCode disposes of them later.

```ts
context.subscriptions.push(
  foam,
  watcher,
  markdownProvider,
  ...
```

Await for feature promises

```ts
    const feats = (await Promise.all(featuresPromises)).filter(r => r != null);

    return {
      extendMarkdownIt: (md: markdownit) => {
        return feats.reduce((acc: markdownit, r: any) => {
          return r.extendMarkdownIt ? r.extendMarkdownIt(acc) : acc;
        }, md);
      },
      foam,
    };
```

[//begin]: # "Autogenerated link references for markdown compatibility"
[understanding-foam-code-base]: understanding-foam-code-base "Understanding the Foam Code Base"
[//end]: # "Autogenerated link references"


[//begin]: # "Autogenerated link references for markdown compatibility"
[understanding-foam-code-base]: understanding-foam-code-base "Understanding the Foam Code Base"
[//end]: # "Autogenerated link references"